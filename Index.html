<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>ì´ì²œ ì‘ì€ê°€ê²Œ ì‚¬ë‘ ì§€ë„</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta property="og:type" content="website">
    <meta property="og:title" content="ì´ì²œ ì‘ì€ê°€ê²Œ ì‚¬ë‘ ì§€ë„">
    <meta property="og:description" content="ì´ì²œ ì§€ì—­í™”í 7% ìºì‹œë°±! ë‚´ ì£¼ë³€ ê°€ë§¹ì ì„ ì§€ë„ì—ì„œ ë°”ë¡œ í™•ì¸í•˜ì„¸ìš”.">
    <style>
        /* ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
        body { margin: 0; padding: 0; font-family: 'Malgun Gothic', 'Apple SD Gothic Neo', sans-serif; background-color: #f9f9f9; }
        
        .container { 
            max-width: 800px; 
            margin: 0 auto; 
            background-color: white; 
            min-height: 100vh; 
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
        }

        /* 1. ìƒë‹¨ í—¤ë” */
        header { 
            padding: 25px 20px; 
            background-color: #ffe812; 
            text-align: center; 
        }
        header h1 { 
            margin: 0 0 10px 0; 
            font-size: 22px; 
            color: #333; 
            font-weight: 800;
        }
        header p { 
            margin: 0; 
            color: #555; 
            font-size: 14px; 
            line-height: 1.4;
            word-break: keep-all; 
        }
        /* ê³µì§€ì‚¬í•­ ë§í¬ ë²„íŠ¼ */
        .notice-link {
            display: inline-block;
            margin-top: 15px;
            padding: 6px 12px;
            background-color: #333;
            color: #fff;
            text-decoration: none;
            font-size: 12px;
            border-radius: 15px;
            font-weight: bold;
            transition: background 0.2s;
        }
        .notice-link:hover { background-color: #555; }

        /* 2. ê²€ìƒ‰ì°½ ì˜ì—­ */
        .search-container {
            padding: 15px 20px 5px 20px;
            background-color: #fff;
            position: sticky;
            top: 0;
            z-index: 20;
        }
        .search-box {
            position: relative;
            width: 100%;
        }
        .search-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ffe812;
            border-radius: 8px;
            font-size: 16px;
            box-sizing: border-box;
            outline: none;
            background-color: #fff;
        }
        .search-input:focus {
            border-color: #e6c300;
        }

        /* 3. ë¶„ë¥˜ ë²„íŠ¼ ì˜ì—­ */
        .category-scroll {
            white-space: nowrap;
            overflow-x: auto;
            padding: 10px 20px 15px 20px;
            background: #fff;
            border-bottom: 1px solid #eee;
            -webkit-overflow-scrolling: touch; 
            position: sticky;
            top: 56px; 
            z-index: 15;
        }
        .category-scroll::-webkit-scrollbar { display: none; }

        .cat-btn {
            display: inline-block;
            padding: 8px 16px;
            margin-right: 6px;
            border: 1px solid #e0e0e0;
            border-radius: 20px;
            background-color: #f8f9fa;
            font-size: 14px;
            color: #666;
            cursor: pointer;
            transition: all 0.2s;
        }
        .cat-btn.active {
            background-color: #333;
            color: #fff;
            border-color: #333;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        /* 4. ì§€ë„ ì˜ì—­ */
        #map { 
            width: 100%; 
            height: 45vh;
        }

        /* 5. ê°€ê²Œ ëª©ë¡ ì˜ì—­ */
        .store-list-box {
            padding: 0 20px 20px 20px;
            background-color: #fff;
        }
        .list-header {
            padding: 15px 0;
            border-bottom: 2px solid #eee;
            margin-bottom: 10px;
            font-weight: bold;
            color: #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .list-count { font-size: 13px; color: #888; font-weight: normal; }

        .store-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }
        .store-table th {
            text-align: left;
            padding: 10px;
            background-color: #f8f9fa;
            color: #555;
            border-bottom: 1px solid #ddd;
        }
        .store-table td {
            padding: 12px 10px;
            border-bottom: 1px solid #eee;
            color: #444;
        }
        .store-name { font-weight: bold; color: #333; }
        .store-addr { font-size: 13px; color: #666; margin-top: 4px; }
        
        .list-scroll-area {
            max-height: 400px;
            overflow-y: auto;
        }

        /* 6. í•˜ë‹¨ ì„¤ëª… */
        .description {
            padding: 30px 20px;
            background-color: #f9f9f9;
            color: #444;
            line-height: 1.6;
            font-size: 13px;
            border-top: 1px solid #ddd;
        }
        .description h3 { font-size: 15px; margin: 0 0 10px 0; }
        .description ul { margin: 0; padding-left: 20px; }
        .description li { margin-bottom: 5px; }

        /* ì •ë³´ì°½ */
        .wrap_info { padding: 5px; font-size: 13px; font-weight: bold; text-align: center; width: 150px; }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1>ğŸ—ºï¸ ì´ì²œ ì‘ì€ê°€ê²Œ ì‚¬ë‘ ì§€ë„</h1>
            <p>ìµœëŒ€ 5ë§Œì›ê¹Œì§€ ê²°ì œê¸ˆì•¡ì˜ 7% ìºì‹œë°±ì´<br>ìˆëŠ” ì´ì²œì˜ ì‘ì€ ê°€ê²Œ ì§€ë„ì…ë‹ˆë‹¤.</p>
            <a href="https://www.icheon.go.kr/news/board/post/view.do?bcIdx=785&mid=0301000000&idx=316102" 
               target="_blank" 
               rel="noopener noreferrer" 
               class="notice-link">
               ğŸ“¢ ì´ì²œì‹œì²­ ê³µì§€ì‚¬í•­ ì›ë³¸ ë³´ê¸°
            </a>
        </header>

        <div class="search-container">
            <div class="search-box">
                <input type="text" id="search-input" class="search-input" placeholder="ğŸ” ê°€ê²Œëª… ë˜ëŠ” ì£¼ì†Œ ê²€ìƒ‰...">
            </div>
        </div>

        <div id="category-box" class="category-scroll">
            </div>

        <div id="map"></div>

        <div class="store-list-box">
            <div class="list-header">
                <span id="current-category-name">ì „ì²´ ëª©ë¡</span>
                <span class="list-count">ì´ <span id="store-count">0</span>ê³³</span>
            </div>
            
            <div class="list-scroll-area">
                <table class="store-table">
                    <thead>
                        <tr>
                            <th style="width: 40%">ê°€ê²Œëª…</th>
                            <th>ì£¼ì†Œ</th>
                        </tr>
                    </thead>
                    <tbody id="store-tbody">
                        </tbody>
                </table>
            </div>
        </div>

        <div class="description">
            <h3>ğŸ“Œ ì•ˆë‚´ì‚¬í•­</h3>
            <ul>
                <li>ì§€ë„ ìƒì˜ ìœ„ì¹˜ê°€ ì‹¤ì œì™€ ë‹¤ë¥¼ ìˆ˜ ìˆìœ¼ë‹ˆ, <strong>ë°˜ë“œì‹œ ì•„ë˜ ëª©ë¡ì˜ ì£¼ì†Œë¥¼ í™•ì¸</strong>í•´ì£¼ì„¸ìš”.</li>
                <li>ìƒë‹¨ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì§€ì—­ë³„(ë„ë¡œëª…)ë¡œ ëª¨ì•„ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
                <li>ì˜¤ë¥˜ëŠ” ëŒ“ê¸€ë¡œ ë‚¨ê²¨ì£¼ì„¸ìš”.</li>
            </ul>
            <br>
            <p style="color:#888;">ë°ì´í„° ì¶œì²˜: ì´ì²œì‹œ ì§€ì—­í™”í ì‘ì€ê°€ê²Œ ê°€ë§¹ì  ëª©ë¡ (2025.12.16.ê¸°ì¤€)</p>
        </div>
    </div>

    <script type="text/javascript" src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=85fd4b6cec4f99983fbc5bf99ca77f7b"></script>

    <script>
        var map;
        var allData = [];
        var currentMarkers = [];
        var currentCategory = 'ì „ì²´'; 
        
        // â˜…ì¤‘ìš”: í˜„ì¬ ì—´ë ¤ìˆëŠ” ì •ë³´ì°½ì„ ê¸°ì–µí•˜ëŠ” ë³€ìˆ˜
        var currentInfowindow = null; 

        window.onload = function() {
            var container = document.getElementById('map');
            var options = {
                center: new kakao.maps.LatLng(37.279, 127.442),
                level: 8
            };
            map = new kakao.maps.Map(container, options);

            var zoomControl = new kakao.maps.ZoomControl();
            map.addControl(zoomControl, kakao.maps.ControlPosition.RIGHT);

            // â˜…ì¤‘ìš”: ì§€ë„ì˜ ë¹ˆ ê³µê°„ì„ í´ë¦­í•˜ë©´ ì •ë³´ì°½ ë‹«ê¸° (ëª¨ë°”ì¼ ëŒ€ì‘ í•µì‹¬)
            kakao.maps.event.addListener(map, 'click', function() {
                if (currentInfowindow) {
                    currentInfowindow.close();
                    currentInfowindow = null;
                }
            });

            var searchInput = document.getElementById('search-input');
            searchInput.addEventListener('input', function() {
                runFilter();
            });

            google.script.run
                .withSuccessHandler(initApp)
                .withFailureHandler(function(err){ alert("ì˜¤ë¥˜: " + err); })
                .getMapData(); 
        };

        function initApp(result) {
            allData = result.locations;
            var categories = result.categories;

            createButtons(categories);

            if (categories.length > 0) {
                setCategory(categories[0]); 
                var firstBtn = document.querySelector('.cat-btn');
                if(firstBtn) firstBtn.classList.add('active');
            }
        }

        function setCategory(categoryName) {
            currentCategory = categoryName;
            runFilter(); 
        }

        function runFilter() {
            removeMarkers(); // ë§ˆì»¤ ì§€ìš¸ ë•Œ ì •ë³´ì°½ë„ ê°™ì´ ì´ˆê¸°í™”ë¨

            var rawKeyword = document.getElementById('search-input').value;
            var searchKeyword = rawKeyword.trim().toLowerCase(); 
            
            var titleText = (currentCategory === 'ì „ì²´' || currentCategory === 'All') ? 'ì „ì²´' : currentCategory;
            if (searchKeyword.length > 0) {
                document.getElementById('current-category-name').innerText = titleText + " ë‚´ ê²€ìƒ‰: " + rawKeyword;
            } else {
                document.getElementById('current-category-name').innerText = titleText + " ëª©ë¡";
            }

            var filteredData = allData.filter(function(item) {
                var isCategoryMatch = (currentCategory === 'ì „ì²´' || currentCategory === 'All') 
                                      ? true 
                                      : (String(item.category) === String(currentCategory));
                
                var isSearchMatch = true;
                if (searchKeyword.length > 0) {
                    var itemName = String(item.name).toLowerCase();
                    var nameMatch = itemName.indexOf(searchKeyword) > -1;
                    
                    var addrMatch = false;
                    if (item.address) {
                        var itemAddr = String(item.address).toLowerCase();
                        addrMatch = itemAddr.indexOf(searchKeyword) > -1;
                    }
                    
                    isSearchMatch = nameMatch || addrMatch;
                }

                return isCategoryMatch && isSearchMatch;
            });

            updateMapAndList(filteredData);
        }

        function updateMapAndList(data) {
            document.getElementById('store-count').innerText = data.length;

            var bounds = new kakao.maps.LatLngBounds();
            var hasValidLocation = false; 

            for (var i = 0; i < data.length; i++) {
                var item = data[i];

                if (item.lat && item.lng) {
                    var position = new kakao.maps.LatLng(item.lat, item.lng);
                    var marker = new kakao.maps.Marker({
                        position: position,
                        map: map
                    });

                    currentMarkers.push(marker);
                    bounds.extend(position);
                    hasValidLocation = true;

                    var content = '<div class="wrap_info">' + item.name + '</div>';
                    var infowindow = new kakao.maps.InfoWindow({ content: content });

                    // â˜…ì¤‘ìš”: ë§ˆì»¤ ì´ë²¤íŠ¸ ë¡œì§ ìˆ˜ì •
                    (function(marker, infowindow) {
                        // PCìš©: ë§ˆìš°ìŠ¤ ì˜¬ë¦¬ë©´ ì—´ë¦¼
                        kakao.maps.event.addListener(marker, 'mouseover', function() { 
                            // ëª¨ë°”ì¼ì—ì„œëŠ” mouseoverê°€ í´ë¦­ê³¼ ë™ì‹œì— ë°œìƒí•  ìˆ˜ ìˆì–´, 
                            // ëª…ì‹œì ìœ¼ë¡œ í´ë¦­ ì´ë²¤íŠ¸ë¥¼ ìš°ì„ ì‹œí•˜ê±°ë‚˜ ì—¬ê¸°ì„œë„ ë‹«ê¸° ë¡œì§ì„ ë„£ì„ ìˆ˜ ìˆì§€ë§Œ,
                            // PC ì‚¬ìš©ì„±ì„ ìœ„í•´ hoverëŠ” ìœ ì§€í•©ë‹ˆë‹¤.
                            infowindow.open(map, marker); 
                        });
                        
                        // PCìš©: ë§ˆìš°ìŠ¤ ë‚˜ê°€ë©´ ë‹«í˜
                        kakao.maps.event.addListener(marker, 'mouseout', function() { 
                            infowindow.close(); 
                        });

                        // ëª¨ë°”ì¼ & PC ê³µìš©: í´ë¦­ ì‹œ ë™ì‘
                        kakao.maps.event.addListener(marker, 'click', function() { 
                            // 1. ì´ë¯¸ ì—´ë¦° ë‹¤ë¥¸ ì •ë³´ì°½ì´ ìˆìœ¼ë©´ ë‹«ìŒ
                            if (currentInfowindow) {
                                currentInfowindow.close();
                            }
                            
                            // 2. í˜„ì¬ ì •ë³´ì°½ ì—´ê¸°
                            infowindow.open(map, marker);
                            
                            // 3. í˜„ì¬ ì •ë³´ì°½ì„ 'ì—´ë¦° ì°½'ìœ¼ë¡œ ë“±ë¡
                            currentInfowindow = infowindow;
                        });
                    })(marker, infowindow);
                }
            }

            if (hasValidLocation) {
                map.setBounds(bounds);
            }

            updateStoreList(data);
        }

        function updateStoreList(data) {
            var tbody = document.getElementById('store-tbody');
            tbody.innerHTML = ''; 

            if (data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="2" style="text-align:center; padding:20px; color:#888;">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤. ğŸ˜¢</td></tr>';
                return;
            }

            data.forEach(function(item) {
                var tr = document.createElement('tr');
                var addressText = item.address ? item.address : "ì£¼ì†Œ ì •ë³´ ì—†ìŒ";
                var badge = "";
                if (!item.lat || !item.lng) {
                    badge = '<span style="color:#e74c3c; border:1px solid #e74c3c; font-size:11px; padding:1px 4px; border-radius:4px; margin-left:5px;">ì§€ë„ ë¯¸í‘œì‹œ</span>';
                }

                tr.innerHTML = `
                    <td><div class="store-name">${item.name}${badge}</div></td>
                    <td><div class="store-addr">${addressText}</div></td>
                `;
                tbody.appendChild(tr);
            });
        }

        function createButtons(list) {
            var box = document.getElementById('category-box');
            box.innerHTML = ''; 

            list.forEach(function(catName) {
                var btn = document.createElement('button');
                btn.className = 'cat-btn';
                btn.innerText = catName;
                
                btn.onclick = function() {
                    var btns = document.querySelectorAll('.cat-btn');
                    btns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    setCategory(catName); 
                };
                
                box.appendChild(btn);
            });
        }

        function removeMarkers() {
            for (var i = 0; i < currentMarkers.length; i++) {
                currentMarkers[i].setMap(null);
            }
            currentMarkers = [];
            // ë§ˆì»¤ê°€ ì‹¹ ì§€ì›Œì§ˆ ë•Œ, ì—´ë ¤ìˆë˜ ì •ë³´ì°½ ì •ë³´ë„ ì´ˆê¸°í™”
            currentInfowindow = null; 
        }
    </script>
</body>
</html>